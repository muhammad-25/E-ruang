
<link rel="stylesheet" href="/css/card.css" />

<link rel="stylesheet" href="/css/add.css" />
<section class="panel">
  <header class="panel__header">
    <div class="title">
      <h1>Edit Ruang Kelas</h1>
      <p class="subtitle">Perbarui informasi ruangan, fasilitas, dan jadwal.</p>
    </div>
  </header>

  <div class="panel__body">
    <form id="editClassForm" action="/edit/update" method="POST" enctype="multipart/form-data">
      
      <input type="hidden" name="id" value="<%= room.id %>">

      <div>
        <div class="card form-card">
          
          <label class="field">
            <span class="label">Nama Ruang</span>
            <input name="name" type="text" value="<%= room.name %>" required />
          </label>

          <div class="row two-cols">
            <label class="field">
              <span class="label">Gedung</span>
              <input name="building" type="text" value="<%= room.gedung %>" />
            </label>

            <label class="field">
              <span class="label">Nomor/Ruang</span>
              <input name="room_number" type="text" value="<%= room.nomor_ruang %>" />
            </label>
          </div>

          <label class="field">
            <span class="label">Deskripsi singkat</span>
            <textarea name="description" rows="3"><%= room.deskripsi %></textarea>
          </label>

          <div class="field">
            <label class="label">Kapasitas (orang)</label>
            <input name="capacity" type="number" value="<%= room.capacity %>" />
          </div>

          <div class="field">
            <span class="label">Fasilitas</span>
            <div id="facilities" class="facilities-selector">
                <% 
                   // List fasilitas master (sebaiknya dilempar dari controller juga, tapi di sini kita hardcode sesuai contoh kamu sebelumnya).
                   // Agar dinamis, cek apakah ID fasilitas ada di array `facilities` (data dari controller)
                   const allFacilities = [
                       {id: 1, name: 'Proyektor'}, {id: 2, name: 'AC'}, 
                       {id: 3, name: 'WiFi'}, {id: 4, name: 'Meja & Kursi'},
                       {id: 5, name: 'Papan Tulis'}, {id: 6, name: 'Sound System'}
                   ];
                %>
                
                <% allFacilities.forEach(item => { %>
                    <label class="facility-card">
                        <input type="checkbox" name="facilities[]" value="<%= item.id %>" 
                               <%= facilities.includes(item.id) ? 'checked' : '' %> > <span><%= item.name %></span>
                    </label>
                <% }) %>
            </div>
          </div>

          <div class="field">
            <span class="label">Foto Saat Ini</span>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <% if(photos && photos.length > 0) { %>
                    <% photos.forEach(p => { %>
                        <img src="/uploads/rooms/<%= p.filename %>" style="width: 80px; height: 60px; object-fit: cover; border-radius: 4px;">
                    <% }) %>
                <% } else { %>
                    <p style="font-size: 0.9em; color: #666;">Belum ada foto.</p>
                <% } %>
            </div>
            
            <span class="label">Tambah Foto Baru (Opsional)</span>
            <input id="photos" name="photos" type="file" accept="image/*" multiple />
            <div id="photoPreview" class="photo-preview"></div>
          </div>

          <div class="field schedule">
            <span class="label">Jadwal tersedia</span>
            <div id="scheduleList">
                
              <% if (schedules && schedules.length > 0) { %>
                <% schedules.forEach(sch => { %>
                  <div class="schedule-row">
                    <div class="days">
                        <div class="day-selector">
                            <% ['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'].forEach(day => { %>
                                <label class="day-card">
                                    <input type="checkbox" value="<%= day %>" class="day-checkbox" 
                                           <%= sch.days.includes(day) ? 'checked' : '' %> >
                                    <span><%= day %></span>
                                </label>
                            <% }) %>
                        </div>
                    </div>
                    <input name="schedule_start[]" type="time" value="<%= sch.start %>" />
                    <span class="to">—</span>
                    <input name="schedule_end[]" type="time" value="<%= sch.end %>" />
                    <input type="hidden" name="schedule_days[]" class="schedule-days-hidden" value="<%= sch.days.join(',') %>" />
                  </div>
                <% }) %>
              
              <% } else { %>
                  <div class="schedule-row">
                    <div class="days">
                        <div class="day-selector">
                            <% ['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'].forEach(day => { %>
                                <label class="day-card">
                                    <input type="checkbox" value="<%= day %>" class="day-checkbox">
                                    <span><%= day %></span>
                                </label>
                            <% }) %>
                        </div>
                    </div>
                    <input name="schedule_start[]" type="time" />
                    <span class="to">—</span>
                    <input name="schedule_end[]" type="time" />
                    <input type="hidden" name="schedule_days[]" class="schedule-days-hidden" />
                  </div>
              <% } %>

            </div>
            </div>

          <div class="form-footer">
            <button type="submit" class="btnadd btn--primary">Simpan Perubahan</button>
            <a href="/admin-DaftarRuangan" class="btnadd" style="background:#ccc; text-decoration:none; text-align:center; color: #333;">Batal</a>
          </div>

        </div>
      </div>
    </form>
  </div>
</section>

<script>
    // ... Copy script JS yang ada di file edit-kelas.ejs asli Anda ...
    // Pastikan logika "change" listener tetap ada agar hidden input terupdate saat checkbox diklik ulang
    document.addEventListener('DOMContentLoaded', function() {
        const scheduleList = document.getElementById('scheduleList');
        scheduleList.addEventListener('change', function(e) {
            if (e.target.classList.contains('day-checkbox')) {
                const row = e.target.closest('.schedule-row');
                const checkedBoxes = row.querySelectorAll('.day-checkbox:checked');
                const hiddenInput = row.querySelector('.schedule-days-hidden');
                const selectedDays = Array.from(checkedBoxes).map(cb => cb.value);
                hiddenInput.value = selectedDays.join(',');
            }
        });
        
        // ... kode preview foto ...
    });
</script>