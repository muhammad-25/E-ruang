<link rel="stylesheet" href="/css/admin-pengajuan.css">

<div class="pengajuan-container">
    
    <div class="pengajuan-card" id="menunggu">
        <h3>Menunggu Persetujuan</h3>
        <div class="table-responsive">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>NIM</th>
                        <th>Tanggal</th>
                        <th>Waktu</th>
                        <th>Nama Kelas</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% const pending = bookings.filter(b => b.status === 'Menunggu'); %>
                    
                    <% if (pending.length > 0) { %>
                        <% pending.forEach(item => { %>
                        <tr>
                            <td><%= item.nim %></td>
                            <td><%= item.date %></td>
                            <td><%= item.time %></td>
                            <td><%= item.room %></td>
                            <td><span class="badge badge-menunggu">Menunggu</span></td>
                            <td>
                                <div class="btn-group">
                                    <a href="#" class="btn-action btn-blue">Setuju</a>
                                    <a href="#" class="btn-action btn-red">Tolak</a>
                                </div>
                            </td>
                        </tr>
                        <% }) %>
                    
                    <% } else { %>
                        <tr class="empty-row">
                            <td colspan="6">Tidak ada pengajuan baru saat ini.</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <div class="pengajuan-card" id="disetujui">
        <h3>Disetujui</h3>
        <div class="table-responsive">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>NIM</th>
                        <th>Tanggal</th>
                        <th>Waktu</th>
                        <th>Nama Kelas</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% const approved = bookings.filter(b => b.status === 'Disetujui'); %>
                    
                    <% if (approved.length > 0) { %>
                        <% approved.forEach(item => { %>
                        <tr>
                            <td><%= item.nim %></td>
                            <td><%= item.date %></td>
                            <td><%= item.time %></td>
                            <td><%= item.room %></td>
                            <td><span class="badge badge-setuju">Disetujui</span></td>
                            <td>
                                <button type="button" class="btn-action btn-blue" onclick="openEditModal('<%= item.id %>')">Edit</button>
                            </td>
                        </tr>
                        <% }) %>
                    <% } else { %>
                        <tr class="empty-row"><td colspan="6">Belum ada data disetujui.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <div class="pengajuan-card" id="ditolak">
        <h3>Ditolak</h3>
        <div class="table-responsive">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>NIM</th>
                        <th>Tanggal</th>
                        <th>Waktu</th>
                        <th>Nama Kelas</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% const rejected = bookings.filter(b => b.status === 'Ditolak'); %>
                    
                    <% if (rejected.length > 0) { %>
                        <% rejected.forEach(item => { %>
                        <tr>
                            <td><%= item.nim %></td>
                            <td><%= item.date %></td>
                            <td><%= item.time %></td>
                            <td><%= item.room %></td>
                            <td><span class="badge badge-tolak">Ditolak</span></td>
                            <td>
                                <button type="button" class="btn-action btn-blue" onclick="openEditModal('<%= item.id %>')">Edit</button>
                            </td>
                        </tr>
                        <% }) %>
                    <% } else { %>
                        <tr class="empty-row"><td colspan="6">Belum ada data ditolak.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>

</div> <div class="modal-overlay" id="editModal">
    <div class="modal-box">
        <button type="button" class="btn-close-modal" onclick="closeModal()">
            <i class="fa-solid fa-xmark"></i>
        </button>

        <div class="modal-icon">
            <i class="fa-solid fa-exclamation"></i>
        </div>

        <h3 class="modal-title">Edit Status</h3>

        <form id="formStatusUpdate" method="POST" action="/admin/booking/update">
            
            <input type="hidden" name="booking_id" id="modalBookingId">
            <input type="hidden" name="new_status" id="modalNewStatus">

            <div class="modal-actions">
                <button type="button" class="btn-modal btn-modal-setuju" onclick="submitStatus('Disetujui')">
                    Setuju
                </button>
                <button type="button" class="btn-modal btn-modal-tolak" onclick="submitStatus('Ditolak')">
                    Tolak
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Fungsi Buka Modal
    function openEditModal(bookingId) {
        // 1. Simpan ID booking ke dalam input tersembunyi
        document.getElementById('modalBookingId').value = bookingId;
        
        // 2. Munculkan Modal (Tambah class 'show')
        document.getElementById('editModal').classList.add('show');
    }

    // Fungsi Tutup Modal
    function closeModal() {
        document.getElementById('editModal').classList.remove('show');
    }

    // Fungsi Submit (Saat tombol Setuju/Tolak ditekan)
    function submitStatus(status) {
        // 1. Isi input status dengan pilihan admin
        document.getElementById('modalNewStatus').value = status;
        
        // 2. Kirim Form
        document.getElementById('formStatusUpdate').submit();
    }

    // Opsional: Tutup modal kalau klik area gelap (background)
    // Hapus kode ini jika kamu ingin mewajibkan user memilih tombol
    /*
    window.onclick = function(event) {
        const modal = document.getElementById('editModal');
        if (event.target == modal) {
            closeModal();
        }
    }
    */
</script>